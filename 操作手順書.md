# Google カレンダーバックアップシステム 操作手順書

## 📋 概要

このシステムは、Google カレンダーのイベントをGoogle スプレッドシートに自動的にバックアップするツールです。安全性を重視し、意図しないカレンダーへの操作を防ぐ設計になっています。

### 主な機能
- カレンダーの全期間バックアップ（初期設定）
- 今日以降のイベントの増分バックアップ
- 毎日指定時刻での自動バックアップ
- 複数カレンダーの対応
- 大量イベントのバッチ処理

## 🚀 初期セットアップ

### 1. スプレッドシートの準備
1. Google スプレッドシートを新規作成します
2. メニューバーの「拡張機能」→「Apps Script」を開きます
3. `Code.js` ファイルに本システムのコードを貼り付けます
4. `appsscript.json` に必要な権限を設定します（下記参照）

### 2. 必要な権限設定（appsscript.json）
```json
{
  "oauthScopes": [
    "https://www.googleapis.com/auth/calendar.readonly",
    "https://www.googleapis.com/auth/spreadsheets",
    "https://www.googleapis.com/auth/drive",
    "https://www.googleapis.com/auth/script.scriptapp",
    "https://www.googleapis.com/auth/script.external_request"
  ]
}
```

### 3. スクリプトのデプロイ
1. Apps Scriptエディタで「デプロイ」→「新しいデプロイ」を選択
2. 種類は「ライブラリ」または「実行可能API」を選択
3. 権限を承認します

## 📝 基本的な使い方

### 1. スプレッドシートのメニュー

スプレッドシートを開くと、「📅 カレンダーバックアップ」メニューが追加されます。

#### メニュー項目
- **🔧 初期設定（全期間バックアップ）** - 最初に実行する全体バックアップ
- **🔄 今日以降のバックアップ** - 手動での増分バックアップ
- **⏰ 自動バックアップ設定** - 毎日の自動実行を設定
- **🛑 自動バックアップ停止** - 自動実行を停止
- **📋 カレンダー一覧表示** - アクセス可能なカレンダー一覧を表示
- **⚙️ 設定** - 現在の設定を確認
- **🗑️ 設定リセット** - すべての設定を初期化

### 2. 初回実行手順

#### ステップ1: 初期設定の実行
1. メニューから「🔧 初期設定（全期間バックアップ）」を選択
2. カレンダー選択ダイアログが表示されます
3. バックアップしたいカレンダーの番号を入力
4. 確認ダイアログで「はい」を選択
5. バックアップが開始されます（大量のイベントがある場合は時間がかかります）

#### ステップ2: 自動バックアップの設定（推奨）
1. メニューから「⏰ 自動バックアップ設定」を選択
2. 毎日朝5時に自動実行されるようになります

### 3. 日常的な運用

#### 手動バックアップ
メニューから「🔄 今日以降のバックアップ」を選択すると、今日以降のイベントを更新します。

#### 自動バックアップ
設定済みの場合、毎日朝5時に自動的に実行されます。

## 🗂️ データの保存形式

### シート構造
各カレンダーごとに独立したシートが作成されます。

#### シート名
`Calendar_[カレンダー名]`

#### 列構成
| 列 | 内容 | 説明 |
|---|---|---|
| A | タイトル | イベントのタイトル |
| B | 開始日時 | イベントの開始日時 |
| C | 終了日時 | イベントの終了日時 |
| D | 場所 | イベントの場所 |
| E | 説明 | イベントの詳細説明 |
| F | ゲスト | 参加者のメールアドレス（カンマ区切り） |
| G | 作成日 | イベントが作成された日時 |
| H | ID | イベントの一意識別子 |

### バックアップ情報シート
「📋 バックアップ情報」シートには、システムの設定情報とバックアップ履歴が記録されます。

## ⚠️ 注意事項

### セキュリティ
- カレンダーIDは必ず明示的に指定する必要があります
- プライマリカレンダー（メインのカレンダー）への操作は慎重に行ってください
- 読み取り専用の権限で動作します（カレンダーの内容は変更されません）

### パフォーマンス
- 大量のイベント（500件以上）がある場合、処理に時間がかかることがあります
- 実行時間制限（5分）があるため、非常に大きなカレンダーは複数回に分けて処理されます

### データの更新
- 日次バックアップでは、今日以降のデータを一度削除してから再取得します
- 過去のイベントは初回バックアップ時のまま保持されます

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### 1. 「カレンダーが見つかりません」エラー
- カレンダーへのアクセス権限を確認してください
- 共有されているカレンダーの場合、適切な権限があることを確認してください

#### 2. 実行時間制限エラー
- イベント数が多すぎる場合に発生します
- 期間を短くして複数回に分けて実行してください

#### 3. 権限エラー
- Apps Scriptの承認画面で必要な権限を許可してください
- `appsscript.json` の設定を確認してください

#### 4. シートが作成されない
- スプレッドシートへの編集権限があることを確認してください
- シート名に使用できない文字が含まれていないか確認してください

## 📊 設定のカスタマイズ

`Code.js` の設定セクションで以下の値を変更できます：

```javascript
const CONFIG = {
    BACKUP_MONTHS_FUTURE: 12,    // 未来何ヶ月分をバックアップするか
    BACKUP_TIME_HOUR: 5,          // 自動バックアップの実行時刻（24時間形式）
    SHEET_PREFIX: 'Calendar_',    // シート名のプレフィックス
    MAX_EVENTS_PER_BATCH: 100,    // バッチ処理での最大イベント数
    EXECUTION_TIME_LIMIT: 5 * 60 * 1000  // 実行時間制限（ミリ秒）
};
```

## 💡 活用例

### 1. チームカレンダーのバックアップ
チームで共有しているカレンダーを定期的にバックアップし、過去のイベント履歴を保存できます。

### 2. 個人カレンダーのアーカイブ
年度末などに個人カレンダーの記録を保存し、振り返りに活用できます。

### 3. イベントデータの分析
スプレッドシートに保存されたデータを使って、会議時間の分析や参加者の統計などを作成できます。

## 🆘 サポート

問題が解決しない場合は、以下の情報とともにシステム管理者にお問い合わせください：
- エラーメッセージの全文
- 実行した操作の手順
- カレンダーの種類（個人/共有/その他）
- おおよそのイベント数