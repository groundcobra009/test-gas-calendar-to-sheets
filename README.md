# Google カレンダー バックアップシステム（コンテナバインド版）

Google カレンダーのイベントを Google スプレッドシートに自動バックアップする Google Apps Script (GAS) プロジェクトです。このバージョンはコンテナバインドスプレッドシートとして動作し、データは同じスプレッドシート内に保存されます。

## 機能

- 📅 **初期バックアップ**: 過去1年から未来1年までのイベントを一括バックアップ
- 🔄 **日次バックアップ**: 今日以降のイベントを削除→再取得方式で更新
- ⏰ **自動実行**: 毎日午前5時に自動バックアップ
- 📊 **複数カレンダー対応**: 複数のカレンダーを同時にバックアップ可能
- 🛡️ **安全機能**: カレンダーIDの明示的な指定が必要（誤操作防止）
- 📈 **大容量対応**: バッチ処理により大量のイベントも処理可能
- 📋 **コンテナバインド**: データは同じスプレッドシート内の別シートに保存

## セットアップ

### 1. スクリプトのデプロイ

1. [Google Apps Script](https://script.google.com) にアクセス
2. 新規プロジェクトを作成
3. `Code.js` と `appsscript.json` の内容をコピー
4. プロジェクトを保存

### 2. 初期設定

1. スクリプトエディタで関数 `onOpen` を実行
2. Google スプレッドシートが作成される
3. スプレッドシートのメニューから「📅 カレンダーバックアップ」→「初期設定」を選択
4. バックアップしたいカレンダーを選択

### 3. 自動バックアップの設定

メニューから「📅 カレンダーバックアップ」→「自動バックアップ設定」を選択すると、毎日午前5時に自動実行されるようになります。

## 使い方

### メニュー項目

- **🔧 初期設定（全期間バックアップ）**: バックアップするカレンダーを選択し、過去1年〜未来1年のイベントをバックアップ
- **🔄 今日以降のバックアップ**: 今日以降のイベントを手動で更新（削除→再取得）
- **⏰ 自動バックアップ設定**: 毎日の自動実行を有効化
- **🛑 自動バックアップ停止**: 自動実行を無効化
- **📋 カレンダー一覧表示**: 利用可能なカレンダーの一覧を表示
- **⚙️ 設定**: 現在の設定内容を確認
- **🗑️ 設定リセット**: 保存された設定を削除

### バックアップデータの形式

各カレンダーは個別のシートに保存され、以下の情報が記録されます：

| 列名 | 説明 |
|------|------|
| タイトル | イベントのタイトル |
| 開始日時 | イベントの開始日時 |
| 終了日時 | イベントの終了日時 |
| 場所 | イベントの場所 |
| 説明 | イベントの詳細説明 |
| ゲスト | 招待されたゲストのメールアドレス |
| 作成日 | イベントの作成日 |
| ID | イベントの一意識別子 |

## 設定項目

`Code.js` の冒頭で以下の設定を変更できます：

```javascript
const CONFIG = {
    BACKUP_MONTHS_FUTURE: 12,        // 未来何ヶ月分をバックアップするか
    BACKUP_TIME_HOUR: 5,              // 自動実行する時刻（24時間形式）
    SHEET_PREFIX: 'Calendar_',        // 各カレンダーシートの接頭辞
    MAX_EVENTS_PER_BATCH: 100,        // バッチあたりの最大イベント数
    EXECUTION_TIME_LIMIT: 5 * 60 * 1000  // 実行時間制限（5分）
};
```

## 注意事項

- ⚠️ **カレンダーIDの指定が必須**: 安全のため、バックアップ対象のカレンダーIDを明示的に指定する必要があります
- 📱 **プライマリカレンダー**: メインのカレンダーを操作する際は特に注意してください
- ⏱️ **実行時間制限**: Google Apps Script の実行時間制限（6分）内で処理が完了するよう設計されています
- 🔄 **更新方式**: 日次バックアップでは今日以降のデータを削除してから再取得します
- 📋 **コンテナバインド**: このスクリプトはスプレッドシートに紐付いて動作し、データは同じスプレッドシート内に保存されます

## トラブルシューティング

### よくある問題

1. **「カレンダーIDを指定してください」エラー**
   - 初期設定でカレンダーを選択していない場合に発生します
   - メニューから初期設定を実行してください

2. **実行時間超過エラー**
   - イベント数が多すぎる場合に発生します
   - バックアップ期間を短くするか、バッチサイズを調整してください

3. **権限エラー**
   - 初回実行時に権限の承認が必要です
   - プロンプトに従って必要な権限を付与してください

4. **「コンテナバインドスプレッドシートが見つかりません」エラー**
   - スクリプトがスプレッドシートに正しく紐付いていない場合に発生します
   - スプレッドシートからスクリプトエディタを開いて実行してください

## 必要な権限

このスクリプトは以下の Google サービスへのアクセス権限が必要です：

- Google カレンダー（読み取り）
- Google スプレッドシート（読み書き）
- Google ドライブ（ファイルの作成・管理）
- Google Apps Script（トリガーの管理）

## ライセンス

このプロジェクトは自由に使用・改変できます。

## 作者

作成日: 2025年7月16日